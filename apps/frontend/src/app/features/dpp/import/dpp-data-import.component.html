<div class="p-4 md:p-8">
  <!-- Header -->
  <div class="mb-6">
    <div class="mb-2 flex items-center gap-2 text-lg">
      <a routerLink="/products" class="font-semibold hover:underline">
        Digital Product Passport
      </a>
      <span class="material-symbols-outlined text-lg">chevron_right</span>
      <span class="font-medium">{{ id() ?? 'Import' }}</span>
    </div>
  </div>

  @if (!id()) {
    <div
      class="flex-ror mb-4 flex items-center gap-2 rounded-lg bg-neutral-200 p-4"
    >
      <mat-form-field appearance="outline" class="grow">
        <mat-label>DPP-Url</mat-label>
        <input matInput type="text" #url />
      </mat-form-field>
      <button mat-flat-button (click)="urlInput.set(url.value)">
        DPP importieren
      </button>
    </div>
  }

  @if (dppQuery.data()) {
    <div
      class="grid items-stretch gap-2 rounded-lg bg-neutral-200 p-4"
      [ngClass]="productId() ? 'grid-cols-2' : 'grid-cols-1'"
      [formGroup]="formGroup"
    >
      @if (productId()) {
        <span class="text-neutral-600">Daten aus GreenComplAI</span>
      }
      <span class="text-neutral-600">Daten aus dem DPP</span>

      @if (productId()) {
        <app-product-card class="grow" [title]="'Id'">
          <span>{{ productQuery.data()?.productId }} </span>
        </app-product-card>
      }

      <app-dpp-card [title]="'Id'" [form]="formGroup.controls.productId"
        ><div class="flex flex-row gap-2">
          <span>{{ dppQuery.data()?.productId }} </span>
        </div>
      </app-dpp-card>
      @if (productId()) {
        <app-product-card [title]="'Name'">
          <span>{{ productQuery.data()?.name ?? 'keine Angabe' }} </span>
        </app-product-card>
      }

      <app-dpp-card [title]="'Name'" [form]="formGroup.controls.name"
        ><div class="flex flex-row gap-2">
          <span>{{ dppQuery.data()?.name ?? 'keine Angabe' }} </span>
        </div>
      </app-dpp-card>
      @if (productId()) {
        <app-product-card [title]="'TARIC-Code'">
          <span>{{ productQuery.data()?.taricCode ?? 'keine Angabe' }} </span>
        </app-product-card>
      }
      <app-dpp-card [title]="'TARIC-Code'" [form]="formGroup.controls.taricCode"
        ><div class="flex flex-row gap-2">
          <span>{{ dppQuery.data()?.taricCode ?? 'keine Angabe' }} </span>
        </div>
      </app-dpp-card>
      @if (productId()) {
        <app-product-card [title]="'Global Trade Item Number (GTIN)'">
          <span>{{ productQuery.data()?.gtin ?? 'keine Angabe' }} </span>
        </app-product-card>
      }
      <app-dpp-card
        [title]="'Global Trade Item Number (GTIN)'"
        [form]="formGroup.controls.gtin"
        ><div class="flex flex-row gap-2">
          <span>{{ dppQuery.data()?.gtin ?? 'keine Angabe' }} </span>
        </div>
      </app-dpp-card>
      @if (productId()) {
        <app-product-card [title]="'Lieferant'">
          @if (!productQuery.data()?.supplier) {
            keine Angabe
          } @else {
            <div class="flex flex-col gap-2">
              <span>{{ productQuery.data()?.supplier?.name }} </span>
              <span
                >{{ productQuery.data()?.supplier?.phone }} |
                {{ productQuery.data()?.supplier?.email }}
              </span>

              @for (
                address of productQuery.data()?.supplier?.addresses;
                track $index
              ) {
                <span
                  >{{ address.street }} {{ address.postalCode }},
                  {{ address.city }} ({{ address.country }})</span
                >
              }
            </div>
          }
        </app-product-card>
      }
      <app-dpp-card [title]="'Lieferant'" [form]="formGroup.controls.supplier">
        @if (!dppQuery.data()?.supplier) {
          keine Angabe
        } @else {
          <div class="flex flex-col gap-2">
            <span>{{ dppQuery.data()?.supplier?.name }} </span>
            <span
              >{{ dppQuery.data()?.supplier?.phone }} |
              {{ dppQuery.data()?.supplier?.email }}
            </span>
            @for (
              address of dppQuery.data()?.supplier?.addresses;
              track $index
            ) {
              <span
                >{{ address.street }} {{ address.postalCode }},
                {{ address.city }} ({{ address.country }})</span
              >
            }
          </div>
        }
      </app-dpp-card>
      @if (productId()) {
        <app-product-card [title]="'Importeur'">
          @if (!productQuery.data()?.importerName) {
            keine Angabe
          } @else {
            <div class="flex flex-col gap-2">
              <span>{{ productQuery.data()?.importerName }} </span>
              <span
                >{{ productQuery.data()?.importerPhone }} |
                {{ productQuery.data()?.importerEmail }}
              </span>

              <span>{{ productQuery.data()?.importerAddress }} </span>
            </div>
          }
        </app-product-card>
      }
      <app-dpp-card [title]="'Importeur'" [form]="formGroup.controls.importer">
        @if (!dppQuery.data()?.importerName) {
          keine Angabe
        } @else {
          <div class="flex flex-col gap-2">
            <span>{{ dppQuery.data()?.importerName }} </span>
            <span
              >{{ dppQuery.data()?.importerPhone }} |
              {{ dppQuery.data()?.importerEmail }}
            </span>
            <span>{{ dppQuery.data()?.importerAddress }} </span>
          </div>
        }
      </app-dpp-card>
      @if (productId()) {
        <app-product-card [title]="'Materialien'">
          @if (productMaterials().materials?.length === 0) {
            keine Angabe
          } @else {
            @for (item of productMaterials().materials; track $index) {
              <span>{{ item }} </span>
            }
            <div class="flex flex-col gap-2"></div>
          }
        </app-product-card>
      }
      <app-dpp-card
        [title]="'Materialien'"
        [form]="formGroup.controls.materials"
      >
        @if (dppMaterials().materials?.length === 0) {
          keine Angabe
        } @else {
          @for (item of dppMaterials().materials; track $index) {
            <span>{{ item }} </span>
          }
          <div class="flex flex-col gap-2"></div>
        }
      </app-dpp-card>
      @if (productId()) {
        <app-product-card [title]="'Kritische Rohstoffe'">
          @if (productMaterials().criticalRawMaterials?.length === 0) {
            keine Angabe
          } @else {
            @for (
              item of productMaterials().criticalRawMaterials;
              track $index
            ) {
              <span>{{ item }} </span>
            }
            <div class="flex flex-col gap-2"></div>
          }
        </app-product-card>
      }
      <app-dpp-card
        [title]="'Kritische Rohstoffe'"
        [form]="formGroup.controls.criticalRawMaterials"
      >
        @if (productMaterials().criticalRawMaterials?.length === 0) {
          keine Angabe
        } @else {
          @for (item of dppMaterials().criticalRawMaterials; track $index) {
            <span>{{ item }} </span>
          }
          <div class="flex flex-col gap-2"></div>
        }
      </app-dpp-card>

      <!-- TODO: is this relevant? Can we import packagings? -->
      <!-- <app-product-card [title]="'Verpackung'">
        @if (productMaterials().packagings?.length === 0) {
          keine Angabe
        } @else {
          @for (item of productMaterials().packagings; track $index) {
            <span>{{ item }} </span>
          }
          <div class="flex flex-col gap-2"></div>
        }
      </app-product-card>
      <app-dpp-card
        [title]="'Verpackung'"
        [form]="formGroup.controls.packagings"
      >
        @if (productMaterials().packagings?.length === 0) {
          keine Angabe
        } @else {
          @for (item of dppMaterials().packagings; track $index) {
            <span>{{ item }} </span>
          }
          <div class="flex flex-col gap-2"></div>
        }
      </app-dpp-card> -->
      @if (productId()) {
        <app-product-card [title]="'Verwendetes Wasser'">
          <span
            >{{
              productQuery.data()?.waterUsed
                ? productQuery.data()?.waterUsed + ' l'
                : 'keine Angabe'
            }}
          </span>
        </app-product-card>
      }
      <app-dpp-card
        [title]="'Verwendetes Wasser'"
        [form]="formGroup.controls.waterUsed"
        ><div class="flex flex-row gap-2">
          <span
            >{{
              dppQuery.data()?.waterUsed
                ? dppQuery.data()?.waterUsed + ' l'
                : 'keine Angabe'
            }}
          </span>
        </div>
      </app-dpp-card>
      @if (productId()) {
        <app-product-card [title]="'CO2-Fußabdruck'">
          <span
            >{{
              productQuery.data()?.productCarbonFootprint
                ? productQuery.data()?.productCarbonFootprint + ''
                : 'keine Angabe'
            }}
          </span>
        </app-product-card>
      }
      <app-dpp-card
        [title]="'CO2-Fußabdruck'"
        [form]="formGroup.controls.productCarbonFootprint"
        ><div class="flex flex-row gap-2">
          <span
            >{{
              dppQuery.data()?.productCarbonFootprint
                ? dppQuery.data()?.productCarbonFootprint
                : 'keine Angabe'
            }}
          </span>
        </div>
      </app-dpp-card>
    </div>

    <div class="flex justify-end py-4">
      <button mat-flat-button (click)="submit()">Daten übernehmen</button>
    </div>
  }
</div>
